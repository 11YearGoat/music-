<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>music++ — Home</title>
<meta name="theme-color" content="#000000"/>

<!-- Minimal inline manifest for PWA install (optional) -->
<link rel="manifest" href='data:application/manifest+json,{"name":"music++","short_name":"music++","start_url":".","display":"standalone","background_color":"#000000","theme_color":"#000000"}'>

<style>
  /* ---------- Base / Material-ish Dark Theme ---------- */
  :root{
    --bg:#000;
    --surface:#0f0f12;
    --card:#151517;
    --muted:#9aa0a6;
    --accent:#1db954;
    --accent-2:#2ee06f;
    --glass: rgba(255,255,255,0.03);
    --radius-lg:18px;
    --radius-sm:10px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#000,#050505);color:#fff;font-family:Inter,Roboto,Arial,sans-serif;-webkit-font-smoothing:antialiased}
  .app{min-height:100vh;display:flex;flex-direction:column}

  /* Top bar */
  header{height:66px;display:flex;align-items:center;justify-content:space-between;padding:0 20px;border-bottom:1px solid rgba(255,255,255,0.03);backdrop-filter: blur(8px)}
  .title{font-weight:700;font-size:1.05rem;letter-spacing:0.6px}
  .top-actions{display:flex;gap:10px;align-items:center}

  /* Layout */
  main{display:flex;gap:20px;padding:22px;align-items:flex-start;flex:1}
  .left-col{flex:1;min-width:320px;display:flex;flex-direction:column;align-items:center}
  .right-panel{width:360px;max-width:40%;display:flex;flex-direction:column}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:var(--radius-lg);padding:18px;box-shadow:0 6px 28px rgba(0,0,0,0.6)}
  .small{font-size:0.9rem;color:var(--muted)}

  /* Big central art */
  .player-center{display:flex;flex-direction:column;align-items:center;gap:12px;width:100%}
  .art-circle{width:320px;height:320px;border-radius:50%;background:linear-gradient(135deg,#0b0b0b,#1a1a1a);display:flex;align-items:center;justify-content:center;font-size:76px;box-shadow:0 20px 60px rgba(0,0,0,0.7), 0 6px 26px rgba(29,185,84,0.06);transition:transform 350ms}
  .art-circle.playing{transform:scale(1.01) rotate(-0.6deg)}

  .now-title{font-weight:700;font-size:20px;letter-spacing:0.2px}
  .now-sub{color:var(--muted);font-size:13px;margin-top:6px}

  /* Player controls row */
  .controls-row{display:flex;align-items:center;gap:12px;margin-top:8px}
  .btn{background:var(--accent);color:#000;border-radius:999px;padding:10px 14px;border:none;cursor:pointer;box-shadow:0 10px 30px rgba(29,185,84,0.12);transition:transform 140ms}
  .btn:active{transform:translateY(1px)}
  .ghost{background:transparent;color:#fff;border:1px solid rgba(255,255,255,0.04);padding:10px 12px;border-radius:999px}
  .icon-sm{width:44px;height:44px;display:flex;align-items:center;justify-content:center;border-radius:10px;background:var(--glass)}

  /* Big sway progress */
  .sway{width:76%;max-width:820px;height:12px;background:var(--glass);border-radius:12px;margin-top:18px;overflow:hidden;cursor:pointer;position:relative}
  .sway .fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2));width:0%;transition:width 80ms linear}

  /* Playlist panel (slide-in) */
  .panel {
    position:fixed; top:0; right:-420px; height:100vh; width:420px; max-width:92%;
    background:linear-gradient(180deg,#070707,#0b0b0b); box-shadow: -30px 0 60px rgba(0,0,0,0.6);
    transition:right 320ms cubic-bezier(.2,.9,.25,1); padding:22px; z-index:80;
  }
  .panel.open{ right:0; }
  .panel .panel-title{font-weight:700;margin-bottom:12px}
  .panel .list{overflow:auto;max-height:calc(100vh - 140px);padding-right:8px}
  .track-row{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;border:1px solid transparent}
  .track-row:hover{background:rgba(255,255,255,0.02);transform:translateY(-3px)}
  .track-row .meta{flex:1}
  .track-title{font-weight:600}
  .track-sub{color:var(--muted);font-size:13px}

  /* liked badge */
  .liked-pill{background:linear-gradient(90deg,#ff4d6d,#ff8aa0);padding:6px 10px;border-radius:999px;color:#fff;font-weight:700;font-size:12px}

  /* sticky mini player bottom */
  .mini{position:fixed;left:18px;right:18px;bottom:18px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:10px;display:flex;align-items:center;gap:12px;box-shadow:0 12px 40px rgba(0,0,0,0.6)}
  .mini .mini-art{width:56px;height:56px;border-radius:10px;background:#111;display:flex;align-items:center;justify-content:center}
  .mini .meta{flex:1}
  .mini .meta .title{font-weight:700}
  .mini .meta .sub{color:var(--muted);font-size:13px}
  .mini .controls{display:flex;gap:8px;align-items:center}

  /* responsive */
  @media (max-width:900px){
    .art-circle{width:220px;height:220px;font-size:44px}
    .sway{width:92%}
    .panel{width:100%;right:-100%}
  }
</style>

</head>
<body>
  <div class="app">
    <header>
      <div class="title">Music Home</div>
      <div class="top-actions">
        <div class="small muted small-muted" style="color:var(--muted)">music++</div>
        <button id="openList" class="btn ghost" title="Open music list">Music List ▸</button>
      </div>
    </header>

    <main>
      <!-- left: big player -->
      <div class="left-col" style="flex:1;display:flex;justify-content:center">
        <div class="card" style="width:100%;max-width:980px;display:flex;flex-direction:column;align-items:center">
          <div class="player-center">
            <div id="art" class="art-circle">♪</div>
            <div id="title" class="now-title">No song selected</div>
            <div id="artist" class="now-sub"></div>

            <div class="player-controls" style="align-items:center;">
              <button id="prev" class="ghost btn" title="Previous">⟨</button>
              <button id="play" class="btn" title="Play">Play</button>
              <button id="next" class="ghost btn" title="Next">⟩</button>
              <button id="like" class="like-btn like-btn" style="margin-left:8px" title="Like" disabled>❤</button>
            </div>

            <div id="sway" class="sway" title="Seek (click)">
              <div id="fill" class="fill"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- right: small info / reserved -->
      <div class="right-panel" style="display:flex;flex-direction:column;gap:12px">
        <div class="card" style="padding:14px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700">Now Playing</div>
            <div id="like-badge" style="display:none" class="liked-pill">LIKED</div>
          </div>
          <div style="margin-top:10px;color:var(--muted);font-size:13px">Control playback from the center, open the list to pick songs.</div>
        </div>

        <div class="card" style="padding:14px;flex:1">
          <div style="font-weight:700;margin-bottom:10px">Queue</div>
          <div id="queue" class="small muted" style="color:var(--muted)">No queue — click songs from the Music List.</div>
        </div>
      </div>
    </main>

    <!-- right-hand slide-in panel -->
    <div id="panel" class="panel" aria-hidden="true">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="panel-title">Music List</div>
        <button id="closeList" class="btn ghost">Close</button>
      </div>
      <div style="height:12px"></div>
      <div id="list" class="list"></div>
      <div style="height:18px"></div>
      <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
        <div class="small" style="color:var(--muted)">Auto-loaded from repo root</div>
        <button id="refreshList" class="btn ghost">Refresh</button>
      </div>
    </div>

    <!-- banner & toast -->
    <div id="banner" class="banner" style="display:none"></div>
    <div id="toast" class="toast" style="display:none"></div>

    <!-- sticky mini player -->
    <div id="mini" class="mini" style="display:none">
      <div class="mini-art" id="miniArt">♪</div>
      <div class="meta">
        <div class="title" id="miniTitle">No song</div>
        <div class="sub" id="miniSub"></div>
        <div class="mini-progress" style="margin-top:8px">
          <div class="fill" id="miniFill" style="width:0%"></div>
        </div>
      </div>
      <div class="controls">
        <button id="miniPlay" class="btn">▶</button>
      </div>
    </div>

    <footer style="padding:14px;text-align:center;color:var(--muted)">free. good. best.</footer>
  </div>

  <!-- audio element (hidden) -->
  <audio id="audio" crossorigin="anonymous"></audio>

  <script>
  /* ===========================
     CONFIG & UTILS
     =========================== */
  const GITHUB_USER = '11yeargoat';
  const GITHUB_REPO = 'music-';
  const GITHUB_API = `https://api.github.com/repos/${GITHUB_USER}/${encodeURIComponent(GITHUB_REPO)}/contents/`;
  // fallback demo tracks if fetch fails (URLs should be replaced by real mp3s later)
  const FALLBACK_TRACKS = [
    { name: 'demo-1.mp3', url: 'https://cdn.pixabay.com/download/audio/2021/10/18/audio_6b4a8b13d1.mp3?filename=epic-emotional-126704.mp3', title: 'Demo 1', artist: 'Sample' },
    { name: 'demo-2.mp3', url: 'https://cdn.pixabay.com/download/audio/2021/08/04/audio_7d63e6a5d5.mp3?filename=ambient-piano-110794.mp3', title: 'Demo 2', artist: 'Sample' }
  ];

  // Find UI nodes
  const nodes = {
    panel: document.getElementById('panel'),
    openList: document.getElementById('openList'),
    closeList: document.getElementById('closeList'),
    list: document.getElementById('list'),
    refreshList: document.getElementById('refreshList'),
    audio: document.getElementById('audio'),
    art: document.getElementById('art'),
    title: document.getElementById('title'),
    artist: document.getElementById('artist'),
    play: document.getElementById('play'),
    prev: document.getElementById('prev'),
    next: document.getElementById('next'),
    like: document.getElementById('like'),
    sway: document.getElementById('sway'),
    fill: document.getElementById('fill'),
    mini: document.getElementById('mini'),
    miniArt: document.getElementById('miniArt'),
    miniTitle: document.getElementById('miniTitle'),
    miniSub: document.getElementById('miniSub'),
    miniPlay: document.getElementById('miniPlay'),
    queue: document.getElementById('queue'),
    banner: document.getElementById('banner'),
    toast: document.getElementById('toast'),
    likeBadge: document.getElementById('like-badge'),
  };

  let tracks = [];          // loaded track objects: {name, download_url, title, artist}
  let current = -1;         // index in tracks
  let isPlaying = false;

  // helper: pretty filename
  function cleanFilename(n){
    return n.replace(/_/g,' ').replace(/\.mp3$/i,'').replace(/\s+-\s+/g,' — ').trim();
  }

  function showToast(msg, ms=2000){
    nodes.toast.textContent = msg;
    nodes.toast.style.display = 'block';
    setTimeout(()=> nodes.toast.style.display = 'none', ms);
  }

  function showBanner(msg){
    nodes.banner.textContent = msg;
    nodes.banner.style.display = 'block';
  }
  function hideBanner(){ nodes.banner.style.display = 'none'; }

  /* ===========================
     PANEL: open/close (slide-in)
     =========================== */
  nodes.openList.addEventListener('click', ()=> nodes.panel.classList.add('open'));
  nodes.closeList.addEventListener('click', ()=> nodes.panel.classList.remove('open'));
  nodes.refreshList.addEventListener('click', ()=> loadTracks());

  /* ===========================
     LOAD TRACKS FROM GITHUB
     =========================== */
  async function loadTracks(){
    nodes.list.innerHTML = '<div style="color:var(--muted)">Loading…</div>';
    try{
      const res = await fetch(GITHUB_API);
      if(!res.ok) throw new Error('GitHub API returned ' + res.status);
      const json = await res.json();
      if(!Array.isArray(json)) throw new Error('Unexpected GitHub response');
      const mp3s = json.filter(f => f.name && typeof f.name === 'string' && f.name.toLowerCase().endsWith('.mp3'));
      if(mp3s.length === 0){
        throw new Error('No mp3 files found');
      }
      tracks = mp3s.map(f => ({
        name: f.name,
        download_url: f.download_url,
        title: cleanFilename(f.name),
        artist: ''
      }));
    }catch(err){
      console.warn('Failed to load from GitHub, using fallback demo tracks', err);
      tracks = FALLBACK_TRACKS.map(t => ({ name: t.name, download_url: t.url, title: t.title, artist: t.artist }));
      showBanner('Using demo tracks — add .mp3 files to repo root to populate the list.');
    }
    renderList();
    updateQueue();
  }

  /* ===========================
     RENDER LIST (panel)
     =========================== */
  function renderList(){
    nodes.list.innerHTML = '';
    tracks.forEach((t, i) => {
      const row = document.createElement('div');
      row.className = 'track-row';
      row.innerHTML = `
        <div style="width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#111,#161616);display:flex;align-items:center;justify-content:center;font-weight:700">${(t.title||t.name||'')?.charAt(0)?.toUpperCase()||'♪'}</div>
        <div class="meta">
          <div class="track-title">${t.title}</div>
          <div class="track-sub">${t.artist || t.name}</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
          <button class="btn ghost" data-i="${i}" title="Play">Play</button>
          <div style="font-size:12px;color:var(--muted)">${t.name}</div>
        </div>
      `;
      nodes.list.appendChild(row);
      row.querySelector('button')?.addEventListener('click', (ev)=>{
        const idx = Number(ev.currentTarget.dataset.i);
        playIndex(idx);
        nodes.panel.classList.remove('open');
      });
    });
    if(tracks.length === 0){
      nodes.list.innerHTML = '<div style="color:var(--muted)">No songs found</div>';
    }
  }

  /* ===========================
     PLAYBACK: playIndex, update UI
     =========================== */
  function playIndex(i){
    if(i<0 || i>=tracks.length) return;
    current = i;
    const t = tracks[current];
    nodes.audio.src = t.download_url;
    nodes.audio.play().catch(()=>{}); // click action should allow
    isPlaying = true;
    nodes.art.classList.add('playing');
    nodes.title.textContent = t.title || t.name;
    nodes.artist.textContent = t.artist || '';
    nodes.mini.style.display = 'flex';
    nodes.miniArt.textContent = (t.title||t.name||'')?.charAt(0)?.toUpperCase()||'♪';
    nodes.miniTitle.textContent = t.title || t.name;
    nodes.miniSub.textContent = t.artist || '';
    nodes.like.disabled = false;
    updateLikeBadge();
    updateQueue();
    setPlayButton(true);
  }

  function setPlayButton(playing){
    isPlaying = !!playing;
    nodes.play.textContent = playing ? 'Pause' : 'Play';
    nodes.miniPlay.textContent = playing ? '❚❚' : '▶';
  }

  function playNext(){
    if(tracks.length === 0) return;
    const nxt = (current + 1) % tracks.length;
    playIndex(nxt);
  }
  function playPrev(){
    if(tracks.length === 0) return;
    const prev = (current - 1 + tracks.length) % tracks.length;
    playIndex(prev);
  }

  /* ===========================
     Audio events: update progress, auto-next
     =========================== */
  nodes.audio.addEventListener('timeupdate', ()=>{
    const d = nodes.audio.duration;
    if(!d || !isFinite(d)) return;
    const pct = (nodes.audio.currentTime / d) * 100;
    nodes.fill.style.width = pct + '%';
    nodes.miniFill.style.width = pct + '%';
  });

  nodes.audio.addEventListener('ended', ()=>{
    setPlayButton(false);
    // autoplay next
    setTimeout(()=> playNext(), 300);
  });

  /* ===========================
     Seeking on sway (big progress)
     =========================== */
  nodes.sway.addEventListener('click', (e)=>{
    const rect = nodes.sway.getBoundingClientRect();
    const pct = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
    const d = nodes.audio.duration;
    if(d && isFinite(d)){
      nodes.audio.currentTime = pct * d;
      // immediate visual:
      nodes.fill.style.width = (pct * 100) + '%';
      nodes.miniFill.style.width = (pct * 100) + '%';
    }
  });

  /* ===========================
     Controls wiring
     =========================== */
  nodes.play.addEventListener('click', ()=>{
    if(!nodes.audio.src){
      if(tracks.length) playIndex(0);
      else { showToast('No track loaded'); return; }
    }
    if(nodes.audio.paused) nodes.audio.play();
    else nodes.audio.pause();
    setPlayButton(!nodes.audio.paused);
  });

  nodes.miniPlay.addEventListener('click', ()=> nodes.play.click());
  nodes.next.addEventListener('click', ()=> playNext());
  nodes.prev.addEventListener('click', ()=> playPrev());

  /* ===========================
     Like button (local)
     =========================== */
  function likesKey(){ return 'musicpp_likes_v1'; }
  function getLikes(){ try{ return JSON.parse(localStorage.getItem(likesKey())||'[]'); }catch(e){ return []; } }
  function setLikes(a){ localStorage.setItem(likesKey(), JSON.stringify(a)); }

  nodes.like.addEventListener('click', ()=>{
    if(current < 0) return;
    const likes = getLikes();
    const name = tracks[current].name;
    const idx = likes.indexOf(name);
    if(idx === -1){ likes.push(name); showToast('Liked'); }
    else { likes.splice(idx,1); showToast('Unliked'); }
    setLikes(likes);
    updateLikeBadge();
    renderLikedPanel();
  });

  function updateLikeBadge(){
    const likes = getLikes();
    if(current >= 0 && likes.indexOf(tracks[current].name) !== -1){ nodes.likeBadge.style.display = 'inline-block'; }
    else nodes.likeBadge.style.display = 'none';
  }

  /* ===========================
     Queue / liked panel rendering
     =========================== */
  function updateQueue(){
    const q = document.getElementById('queue');
    if(tracks.length === 0){ q.textContent = 'No queue — click songs from the Music List.'; return; }
    q.innerHTML = '';
    tracks.slice(0,6).forEach((t,i)=>{
      const el = document.createElement('div');
      el.style.display = 'flex'; el.style.justifyContent = 'space-between'; el.style.padding = '6px 0';
      el.innerHTML = `<div style="color:var(--muted);font-size:13px">${i===current? '▶ ':' '}${t.title}</div><div style="color:var(--muted);font-size:13px">${t.artist||''}</div>`;
      q.appendChild(el);
    });
  }

  function renderLikedPanel(){
    const p = document.getElementById('liked');
    p.innerHTML = '';
    const likes = getLikes();
    if(likes.length === 0){ p.innerHTML = '<div style="color:var(--muted);padding:8px">No liked songs</div>'; return; }
    likes.forEach(name=>{
      const t = tracks.find(x=>x.name === name) || {name};
      const r = document.createElement('div'); r.className = 'track-row';
      r.innerHTML = `<div style="width:44px;height:44px;border-radius:8px;background:#111;display:flex;align-items:center;justify-content:center">${(t.title||t.name||'')?.charAt(0)?.toUpperCase()||'♪'}</div>
        <div class="meta"><div class="track-title">${t.title||cleanFilename(t.name)}</div><div class="track-sub">${t.artist||t.name}</div></div>`;
      p.appendChild(r);
    });
  }

  /* ===========================
     Init: load tracks, SW registration
     =========================== */
  async function init(){
    await loadTracks();
    renderLikedPanel();
    // simple SW register for caching shell (optional)
    if('serviceWorker' in navigator){
      const swCode = `self.addEventListener('install',e=>self.skipWaiting());self.addEventListener('activate',e=>clients.claim());self.addEventListener('fetch',e=>{ if(e.request.method!=='GET') return; e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request))); })`;
      const blob = new Blob([swCode], {type:'application/javascript'});
      try{ await navigator.serviceWorker.register(URL.createObjectURL(blob)); }catch(e){ /* ignore */ }
    }
  }

  // run
  init();

  </script>
</body>
</html>
